<!DOCTYPE html>
<html lang="en" class="">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>{{ title if title else site_title }}</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
  <link href="{{ url_for('static', filename='styles.css') }}" rel="stylesheet"/>

  <!-- Early theme apply: system default on first visit, saved preference afterward -->
  <script>
    (function() {
      try {
        var saved = localStorage.getItem("theme");
        if (saved === "theme-light" || saved === "theme-dark") {
          document.documentElement.classList.add(saved);
        } else {
          if (window.matchMedia("(prefers-color-scheme: light)").matches) {
            document.documentElement.classList.add("theme-light");
          } else {
            document.documentElement.classList.add("theme-dark");
          }
        }
      } catch (e) {
        if (window.matchMedia("(prefers-color-scheme: light)").matches) {
          document.documentElement.classList.add("theme-light");
        } else {
          document.documentElement.classList.add("theme-dark");
        }
      }
    })();
  </script>

  <style>
    /* Smooth page transition with fade + slide + zoom */
    .fade-transition {
      opacity: 0;
      transform: translateY(20px) scale(0.98);
      transition: opacity 1s ease-in-out, transform 1s ease-in-out;
    }
    .fade-transition.fade-in {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
    .fade-transition.fade-out {
      opacity: 0;
      transform: translateY(20px) scale(0.95);
    }

    nav.navbar {
      opacity: 1;
      transition: opacity 0.8s ease-in-out;
    }
    nav.navbar.fade-out {
      opacity: 0;
    }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-md navbar-dark bg-gradient sticky-top shadow-sm">
  <a class="navbar-brand font-logo" href="{{ url_for('index') }}">Alejandro Ines</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navMain">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div id="navMain" class="collapse navbar-collapse">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item"><a class="nav-link {% if request.endpoint=='gallery' %}active{% endif %}" href="{{ url_for('gallery') }}">Gallery</a></li>
      <li class="nav-item"><a class="nav-link {% if request.endpoint=='blog' %}active{% endif %}" href="{{ url_for('blog') }}">Blog</a></li>
      <li class="nav-item"><a class="nav-link {% if request.endpoint=='about' %}active{% endif %}" href="{{ url_for('about') }}">About</a></li>
      <li class="nav-item"><a class="nav-link {% if request.endpoint=='contact' %}active{% endif %}" href="{{ url_for('contact') }}">Contact</a></li>
    </ul>

    {# Optional: re-enable by passing show_search=True in a context processor #}
    {% if show_search %}
    <form class="form-inline" action="{{ url_for('search') }}" method="get">
      <input class="form-control form-control-sm mr-2" type="search" name="q" placeholder="Search" value="{{ request.args.get('q','') }}">
      <button class="btn btn-outline-light btn-sm mr-2" type="submit">Go</button>
    </form>
    {% endif %}

    <button id="toggleTheme" class="btn btn-warning btn-sm">Theme</button>
  </div>
</nav>

{% with messages = get_flashed_messages(with_categories=True) %}
{% if messages %}
<div class="container mt-3">
  {% for category,msg in messages %}
  <div class="alert alert-{{ category }} alert-dismissible fade show">{{ msg }}
    <button type="button" class="close" data-dismiss="alert">&times;</button>
  </div>
  {% endfor %}
</div>
{% endif %}
{% endwith %}

{% block body %}{% endblock %}

<!-- Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Smooth Page Transition JS -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const body = document.body;
  const navbar = document.querySelector("nav.navbar");

  body.classList.add("fade-transition");

  // Fade in when page loads
  requestAnimationFrame(() => {
    body.classList.add("fade-in");
  });

  // Intercept links for fade-out
  document.querySelectorAll("a[href]").forEach(link => {
    const url = link.getAttribute("href");
    if (!url || url.startsWith("#") || url.startsWith("javascript:")) return;

    link.addEventListener("click", function (e) {
      if (link.target === "_blank" || e.metaKey || e.ctrlKey) return;
      e.preventDefault();

      if (navbar) navbar.classList.add("fade-out");
      body.classList.remove("fade-in");
      body.classList.add("fade-out");

      let navigated = false;
      function go() {
        if (!navigated) {
          navigated = true;
          window.location.href = url;
        }
      }

      body.addEventListener("transitionend", function handler(event) {
        if (event.target === body) {
          body.removeEventListener("transitionend", handler);
          go();
        }
      });

      setTimeout(go, 1200); // failsafe
    });
  });
});
</script>

<!-- Your theme toggle / other scripts -->
<script src="{{ url_for('static', filename='main.js') }}"></script>
</body>
</html>
